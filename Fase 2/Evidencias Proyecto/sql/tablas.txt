-- 1) Tabla de clientes (tutores de mascotas)
CREATE TABLE clientes (
    id_cliente      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre          VARCHAR2(100) NOT NULL,
    apellido        VARCHAR2(100) NOT NULL,
    telefono        VARCHAR2(20),
    email           VARCHAR2(150) UNIQUE NOT NULL,
    direccion       VARCHAR2(200)
);

-- 2) Tabla de profesionales
CREATE TABLE profesionales (
    id_profesional  NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre          VARCHAR2(100) NOT NULL,
    apellido        VARCHAR2(100) NOT NULL,
    especialidad    VARCHAR2(100),
    telefono        VARCHAR2(20),
    email           VARCHAR2(150) UNIQUE
);

-- 3) Tabla de servicios
CREATE TABLE servicios (
    id_servicio     NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre          VARCHAR2(100) NOT NULL,
    descripcion     VARCHAR2(300),
    precio          NUMBER(10,2)
);

-- 4) Tabla de mascotas
CREATE TABLE mascotas (
    id_mascota      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre          VARCHAR2(100) NOT NULL,
    especie         VARCHAR2(50) NOT NULL,   -- Perro, Gato, etc.
    raza            VARCHAR2(100),
    edad            NUMBER,
    id_cliente      NUMBER NOT NULL,
    CONSTRAINT fk_mascota_cliente FOREIGN KEY (id_cliente)
        REFERENCES clientes(id_cliente) ON DELETE CASCADE
);

-- 5) Tabla de citas (agenda)
CREATE TABLE citas (
    id_cita         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    fecha_hora      TIMESTAMP NOT NULL,
    estado          VARCHAR2(20) DEFAULT 'Pendiente',
    id_cliente      NUMBER NOT NULL,
    id_mascota      NUMBER NOT NULL,
    id_profesional  NUMBER NOT NULL,
    id_servicio     NUMBER NOT NULL,
    CONSTRAINT fk_cita_cliente FOREIGN KEY (id_cliente)
        REFERENCES clientes(id_cliente) ON DELETE CASCADE,
    CONSTRAINT fk_cita_mascota FOREIGN KEY (id_mascota)
        REFERENCES mascotas(id_mascota) ON DELETE CASCADE,
    CONSTRAINT fk_cita_profesional FOREIGN KEY (id_profesional)
        REFERENCES profesionales(id_profesional) ON DELETE CASCADE,
    CONSTRAINT fk_cita_servicio FOREIGN KEY (id_servicio)
        REFERENCES servicios(id_servicio) ON DELETE CASCADE
);

-- 6) Tabla de blog/art√≠culos educativos
CREATE TABLE articulos (
    id_articulo     NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    titulo          VARCHAR2(200) NOT NULL,
    contenido       CLOB NOT NULL,
    fecha_publicacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 7) Tabla de contactos (formulario web)
CREATE TABLE contactos (
    id_contacto     NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre          VARCHAR2(100) NOT NULL,
    email           VARCHAR2(150) NOT NULL,
    mensaje         CLOB NOT NULL,
    fecha_envio     TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);




ALTER TABLE clientes ADD (rut VARCHAR2(12) UNIQUE);






CREATE OR REPLACE VIEW vista_citas AS
SELECT 
  c.id_cita,
  c.fecha_hora,
  c.estado,
  cl.nombre || ' ' || cl.apellido AS cliente,
  m.nombre AS mascota,
  p.nombre || ' ' || p.apellido AS profesional,
  s.nombre AS servicio
FROM citas c
JOIN clientes cl ON c.id_cliente = cl.id_cliente
JOIN mascotas m ON c.id_mascota = m.id_mascota
JOIN profesionales p ON c.id_profesional = p.id_profesional
JOIN servicios s ON c.id_servicio = s.id_servicio;

