CREATE TABLE clientes (
    id_cliente NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre VARCHAR2(50) NOT NULL,
    apellido VARCHAR2(50) NOT NULL,
    rut VARCHAR2(12) UNIQUE NOT NULL,
    telefono VARCHAR2(15),
    email VARCHAR2(50),
    nombre_mascota VARCHAR2(50) NOT NULL,
    raza VARCHAR2(50),
    tipo_mascota VARCHAR2(30) -- opcional, perro, gato, etc.
);

CREATE TABLE servicios (
    id_servicio NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre_servicio VARCHAR2(50) NOT NULL,
    descripcion VARCHAR2(200),
    precio NUMBER(8,2)
);



INSERT INTO servicios (nombre_servicio, descripcion, precio) VALUES ('Peluquería', 'Baño y corte de pelo', 15000);
INSERT INTO servicios (nombre_servicio, descripcion, precio) VALUES ('Consulta Veterinaria', 'Revisión médica general', 20000);



CREATE TABLE citas (
    id_cita NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_cliente NUMBER REFERENCES clientes(id_cliente),
    id_servicio NUMBER REFERENCES servicios(id_servicio),
    fecha_hora TIMESTAMP NOT NULL,
    estado VARCHAR2(20) DEFAULT 'pendiente' CHECK (estado IN ('pendiente','confirmada','cancelada'))
);

CREATE TABLE admin (
    id_admin NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    usuario VARCHAR2(50) UNIQUE NOT NULL,
    password VARCHAR2(100) NOT NULL
);


INSERT INTO admin (usuario, password) VALUES ('admin', 'veterinariapucara213'); -- luego puedes encriptar


CREATE TABLE blog (
    id_post NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    titulo VARCHAR2(100) NOT NULL,
    contenido CLOB NOT NULL,
    fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    autor VARCHAR2(50) DEFAULT 'admin'
);


-- 1. Eliminar columna AUTOR
ALTER TABLE BLOG DROP COLUMN AUTOR;

-- 2. Agregar columna IMAGEN_URL
ALTER TABLE BLOG ADD IMAGEN_URL VARCHAR2(300);


-- 1) Tabla de profesionales, ligada a un servicio
CREATE TABLE profesionales (
  id_profesional NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nombre         VARCHAR2(50) NOT NULL,
  apellido       VARCHAR2(50) NOT NULL,
  id_servicio    NUMBER       NOT NULL,
  telefono       VARCHAR2(20),
  email          VARCHAR2(100),
  activo         CHAR(1) DEFAULT 'S' CHECK (activo IN ('S','N')),
  CONSTRAINT fk_prof_serv FOREIGN KEY (id_servicio)
    REFERENCES servicios(id_servicio)
);


-- 2) Agregar duración a los servicios (en minutos)
ALTER TABLE servicios ADD duracion_minutos NUMBER(3) DEFAULT 30 NOT NULL;

-- Ejemplos de actualización (ajústalo a tus datos reales)
UPDATE servicios SET duracion_minutos = 30 WHERE LOWER(nombre_servicio) LIKE '%consulta%';
UPDATE servicios SET duracion_minutos = 60 WHERE LOWER(nombre_servicio) LIKE '%peluquer%';

COMMIT;


ALTER TABLE citas 
ADD id_profesional NUMBER;

ALTER TABLE citas
ADD CONSTRAINT fk_cita_profesional
FOREIGN KEY (id_profesional)
REFERENCES profesionales(id_profesional);


UPDATE servicios SET duracion_minutos = 120 WHERE id_servicio = 1;
UPDATE servicios SET duracion_minutos = 30 WHERE id_servicio = 2;

COMMIT;


